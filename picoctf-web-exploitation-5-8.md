---
description: (Challenges 5-8)
---

# PicoCTF Web Exploitation 5-8

## 5. Some Assembly Required 1

<details>

<summary>Provided Hints:</summary>

(None)

</details>

**Description:** [http://mercury.picoctf.net:1896/index.html](http://mercury.picoctf.net:1896/index.html)

The title makes reference to Assembly, so its probably safe to assume there will be some use of assembly in the source code.

Inspect element the page, upon expanding the HTML code we can see an embed for JavaScript code. Navigate to sources and click on the .js file.

Looking at the JavaScript code, it is apparent that it has been obfuscated. Code is often obfuscated/transformed to make it as difficult as possible for a reader to read and understand. This is usually done to protect code from reverse engineering and unauthorized use.

We want to de-obfuscate the code or atleast make it readable for us. Either download the source file by right clicking on it and auto-format it in a code editor, or go to [https://deobfuscate.io/](https://deobfuscate.io/) and copy and paste the JS code.

Personally I used the website to deobfuscate the code making sure to check "Rename Hex Identifiers" to more easily understand the variables used.

In summary, this code sets up a WebAssembly module on line 21, retrieving input values from an HTML input element, passing them to the WebAssembly module for processing, and displaying a message from the array based on the result returned by the module.

If we go back to our web client, notice another section in source under "mercury.picoctf.net" titled "wasm". Wasm, aka Web Assembly is "a binary instruction format for a stack-based virtual machine. Wasm is designed as a portable compilation target for programming languages, enabling deployment on the web for client and server applications." Clicking on the wasm dropdown, into the file, scrolling down, gives us our flag.

Copy and paste the flag into our input field and it should return "Correct!".&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_10_15_44.png" alt=""><figcaption></figcaption></figure>

## 6. More Cookies

<details>

<summary>Provided Hints:</summary>

[https://en.wikipedia.org/wiki/Homomorphic\_encryption](https://en.wikipedia.org/wiki/Homomorphic\_encryption)

The search endpoint is only helpful for telling you if you are admin or not, you won't be able to guess the flag name

</details>

**Description:** I forgot Cookies can Be modified Client-side, so now I decided to encrypt them! [http://mercury.picoctf.net:25992/](http://mercury.picoctf.net:25992/)

This challenge was very difficult and required external help, this challenge will require a python script written by [Professor Carlisle](https://www.youtube.com/@carlislemc).&#x20;

Observe the cookies stored in the website upon clicking on the link. This time, the value of the cookie named "auth\_name" seems to be base64 encoded. Trying to encode this string gives another base64 string, which upon decoding once more returns an encrypted string.

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_10_45_01.png" alt=""><figcaption></figcaption></figure>

The hint makes mention of homomorphic encryption, "a form of [encryption](https://en.wikipedia.org/wiki/Encryption) with an additional evaluation capability for computing over encrypted data without access to the [secret key](https://en.wikipedia.org/wiki/Key\_\(cryptography\))." Looking back at a portion of our challenge description, "Cookies can Be modified Client-side", notice the letters C, B, C, are capitalized in this order. This is in reference to a "CBC (Cipher Block Chaining) bitflip", an attack that utilizes the properties of the CBC mode of operation in symmetric encryption algorithms. In CBC mode, each plaintext block is XORed with the previous block before being encrypted. In a CBC bitflip, specific bits are flipped in a chosen ciphertext block, modifying the corresponding bits in the decrypted plaintext block.

Professor Carlisle's python module[^1] will help us utilize the CBC bitflip attack. The python module works in these steps...

{% hint style="info" %}
To utilize this code, hover over module, and copy and paste it into a text editor. Change the port number in the 2 requests to the site to the port number you are connected to.
{% endhint %}

1. A session is established to [http://mercury.picoctf.net:25992/](http://mercury.picoctf.net:25992/) on your specified port
2. The value of cookie "auth\_name" is retreived and decoded through base64 twice
3. A loop of 128 iterations is initialized
4. Within each iteration, the position is calculated by integer division of i by 8, indicating which byte in our decoded string needs to be modified.
5. The guessdec variable is created by replacing one bit at a time in our decoded string at a calculated position.
   * The bit is flipped using the XOR operator with the value 1 left-shifted by the remainder of i divided by 8.
   * The to\_bytes() method is used to convert the resulting integer into a bytes object.
6. The modified guessdec is then base64-encoded twice and assigned to guessenc1.
7. The guess variable is then assigned the decoded guessdec after base64 encoding it again using and converting it to a string.
8. A GET request is made to the same URL with the modified cookie value in the request's cookies.
9. If the response contains the substring "pico", it is printed out.

Run the program and it should return a response from the website including our flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_11_06_47.png" alt=""><figcaption></figcaption></figure>

## 7. Where are the Robots

<details>

<summary>Provided Hints:</summary>

What part of the website could tell you where the creator doesn't want you to look?

</details>

**Description:** Can you find the robots? `https://jupiter.challenges.picoctf.org/problem/36474/` ([link](https://jupiter.challenges.picoctf.org/problem/36474/)) or http://jupiter.challenges.picoctf.org:36474

This challenge requires us to find the "robots" throughout the given site. Recall [#4.-scavenger-hunt](./#4.-scavenger-hunt "mention") and having found out about the robots.txt file. We learned that the robots.txt file tells search engine crawlers which URLs the crawler can access on your site. Navigate to the robots.txt file by changing the directory.

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_11_22_35.png" alt=""><figcaption></figcaption></figure>

It looks like all crawlers are not allowed to crawl any url that contains the /477e.html directory. Manually navigate to this directory and we are given the flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_11_22_36.png" alt=""><figcaption></figcaption></figure>

## 8. Logon

<details>

<summary>Provided Hints:</summary>

Hmm it doesn't seem to check anyone's password, except for Joe's?

</details>

**Description:** The factory is hiding things from all of its users. Can you login as Joe and find what they've been looking at? `https://jupiter.challenges.picoctf.org/problem/13594/` ([link](https://jupiter.challenges.picoctf.org/problem/13594/)) or http://jupiter.challenges.picoctf.org:13594

The description states that Joe is the only username that is checked for an authorized password. Trying some default login credentials doesn't seem to work.

Try logging in with any other username and surprisingly it logs us in. Upon logging in, check the stored cookies. Observer a cookie named "admin" with a value of "False", I changed this value to "True" and reloaded the page. This leads us to the flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_12_03_24.png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/Screenshot_2023-06-01_12_03_31 (1) (1).png" alt=""><figcaption></figcaption></figure>

[^1]: Code:

    ```python
    #!/usr/bin/python3
    import requests
    import base64

    s=requests.Session()
    s.get("http://mercury.picoctf.net:25992/")
    cookie=s.cookies["auth_name"]
    print(cookie)
    unb64=base64.b64decode(cookie)
    print(unb64)
    unb64b=base64.b64decode(unb64)
    for i in range (0,128):
       pos=i//8
       guessdec=unb64b[0:pos]+((unb64b[pos]^(1<<(i%8))).to_bytes(1,'big'))+unb64b[pos+1:]
       guessenc1 = base64.b64encode(guessdec)
       guess=base64.b64encode(base64.b64encode(guessdec)).decode()
       r=requests.get("http://mercury.picoctf.net:25992/",cookies={"auth_name": guess})
       if "pico" in r.text:
           print(r.text
    ```
