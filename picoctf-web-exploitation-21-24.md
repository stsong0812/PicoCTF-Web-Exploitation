# PicoCTF Web Exploitation: 21-24

## 21. Super Serial

<details>

<summary>Provided Hints:</summary>

The flag is at ../flag

</details>

**Description:** Try to recover the flag stored on this website [http://mercury.picoctf.net:8404/](http://mercury.picoctf.net:8404/)

Visiting the website, there doesn't seem to be much we can do with its interface or source code. Through some digging, navigate to "robots.txt" as we have done in previous challenges to look for some possible clues.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_07_53.png" alt=""><figcaption></figcaption></figure>

We see an instruction for web crawlers not to access any URL that contains /admin.phps. We can try to navigate to this admin.phps file but we do not have access. What the file does tell us is that .phps files are configured in this server. ".phps" files output the source code instead of the HTML that would normally be generated. Try going to "index.phps", now not only do we see the HTML code, but also the internal php code.&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_20_52.png" alt=""><figcaption></figcaption></figure>

The php code seems to embed code from cookie.php and handle the user login process. If the user input username and password is present, it establishes an SQLite3 database connection and verifies the user's permissions. Additionally, if the user is a guest or admin, it sets a cookie containing the serialized, base64 encoded, urlencoded permissions object and redirects the user to the authentication.php page.

We have found two additional points of interest, cookie.phps and authentication.phps. Cookie.phps contains a permissions class which includes functions that allows you to check if a user has guest or admin privileges based on their username and password stored in the database. While authentication.phps contains an "access\_log" function that checks if the user has admin privileges using the permissions class and then logs the login activity to an access log file. This is important, our ability to write to an access log file through the access\_log function can allow us to create a log object that will read the flag at "../flag", deserialize, and  url and base64 encode it passing it to the login cookie to display a deserialization error in cookie.phps.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_52_13.png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_52_17.png" alt=""><figcaption></figcaption></figure>

We want to create our own cookie that will utilize the access log class in order to read the flag at the provided directory. To do this, we need a php compiler, i used this [one](https://www.programiz.com/php/online-compiler/) online. We want to create our log class that serializes an instance of the access\_log class, encodes it in base64, and then URL-encodes the resulting string, contrary to deserialization in cookie.phps.

```
<?php
class access_log
{
	public $log_file = "../flag";
}

print(urlencode(base64_encode(serialize(new access_log))))
?>
```

Run this code for our serialized string. Since upon successful login, we are directed to authentication.php, we want to go to authentication.php. From there, we can change the value of the login cookie. Create a cookie called login, and paste our serialized string and refresh the page.

Now we are given the deserialization error along with our flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_13_16_33.png" alt=""><figcaption></figcaption></figure>

## 22. More Cookies

<details>

<summary>Provided Hints:</summary>

How secure is a flask cookie?

</details>

**Description:** Alright, enough of using my own encryption. Flask session cookies should be plenty secure! [server.py](https://mercury.picoctf.net/static/26760321c25c9659050a37a707247690/server.py) [http://mercury.picoctf.net:52134/](http://mercury.picoctf.net:52134/)
