# PicoCTF Web Exploitation: 21-24

## 21. Super Serial

<details>

<summary>Provided Hints:</summary>

The flag is at ../flag

</details>

**Description:** Try to recover the flag stored on this website [http://mercury.picoctf.net:8404/](http://mercury.picoctf.net:8404/)

Visiting the website, there doesn't seem to be much we can do with its interface or source code. Through some digging, navigate to "robots.txt" as we have done in previous challenges to look for some possible clues.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_07_53.png" alt=""><figcaption></figcaption></figure>

We see an instruction for web crawlers not to access any URL that contains /admin.phps. We can try to navigate to this admin.phps file but we do not have access. What the file does tell us is that .phps files are configured in this server. ".phps" files output the source code instead of the HTML that would normally be generated. Try going to "index.phps", now not only do we see the HTML code, but also the internal php code.&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_20_52.png" alt=""><figcaption></figcaption></figure>

The php code seems to embed code from cookie.php and handle the user login process. If the user input username and password is present, it establishes an SQLite3 database connection and verifies the user's permissions. Additionally, if the user is a guest or admin, it sets a cookie containing the serialized, base64 encoded, urlencoded permissions object and redirects the user to the authentication.php page.

We have found two additional points of interest, cookie.phps and authentication.phps. Cookie.phps contains a permissions class which includes functions that allows you to check if a user has guest or admin privileges based on their username and password stored in the database. While authentication.phps contains an "access\_log" function that checks if the user has admin privileges using the permissions class and then logs the login activity to an access log file. This is important, our ability to write to an access log file through the access\_log function can allow us to create a log object that will read the flag at "../flag", deserialize, and  url and base64 encode it passing it to the login cookie to display a deserialization error in cookie.phps.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_52_13.png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_12_52_17.png" alt=""><figcaption></figcaption></figure>

We want to create our own cookie that will utilize the access log class in order to read the flag at the provided directory. To do this, we need a php compiler, i used this [one](https://www.programiz.com/php/online-compiler/) online. We want to create our log class that serializes an instance of the access\_log class, encodes it in base64, and then URL-encodes the resulting string, contrary to deserialization in cookie.phps.

```
<?php
class access_log
{
	public $log_file = "../flag";
}

print(urlencode(base64_encode(serialize(new access_log))))
?>
```

Run this code for our serialized string. Since upon successful login, we are directed to authentication.php, we want to go to authentication.php. From there, we can change the value of the login cookie. Create a cookie called login, and paste our serialized string and refresh the page.

Now we are given the deserialization error along with our flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_13_16_33.png" alt=""><figcaption></figcaption></figure>

## 22. Most Cookies

<details>

<summary>Provided Hints:</summary>

How secure is a flask cookie?

</details>

**Description:** Alright, enough of using my own encryption. Flask session cookies should be plenty secure! [server.py](https://mercury.picoctf.net/static/26760321c25c9659050a37a707247690/server.py) [http://mercury.picoctf.net:52134/](http://mercury.picoctf.net:52134/)

Observe the given "server.py" file. This is a Flask application (a lightweight Python web framework that provides useful tools and features for creating web applications in Python) that utilizes a cookie authentication system. It contains a list of all possible cookies we can enter to the website, and the secret key is set to any one of the random list of cookies. Notice if the user is authenticated they are redirected to "/display".

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_14_58_13.png" alt=""><figcaption></figcaption></figure>

Additionally, if the user is authenticated as "admin", the flag is displayed. Go to the /display directory in the site and grab to value of the only stored cookie. The stored cookie, as stated in the description is a Flask session cookie. We can base64 decode the cookie through the command line. Echo the cookie and base64 decode with a pipe.&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_15_02_54.png" alt=""><figcaption></figcaption></figure>

Observe the key value pair of our blank cookie.  We see that the value of "very\_auth" is "blank", we want this value to be "admin" as in the server.py file, if the value is admin, we are given the flag.

Through HackTrick's article about [Flask](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/flask), we find a tool that allows us to encode, deode, sign, unsign, and brute force Flask cookies. Run the command&#x20;

```
pip3 install flask-unsign
flask-unsign --unsign --cookie (your cookie) --wordlist wordlist.txt
```

The output for this cookie unsigning gave the key of "butter", this time, run the command

```
flask-unsign --sign --cookie "{'very_auth':'admin'}" --secret 'butter'
```

Enter the output into the cookie on the website and we are given the flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_15_17_32.png" alt=""><figcaption></figcaption></figure>

## 23. Caas

<details>

<summary>Provided Hints:</summary>

(None)

</details>

**Description:** Now presenting [cowsay as a service](https://caas.mars.picoctf.net/)

Download the provided index.js file then visit the provided site. Following the instructions we can substitute any message and we can see a cow saying the provided message.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_15_23_04.png" alt=""><figcaption></figcaption></figure>

Observing the index.js file we can see on line 8 it looks like our message is input as a parameter and sent to the client's command line, specifically in "/usr/games/cowsay". Instead of sending a lone message, we can pipe another command onto it. Our second command should not be ouput back to us as plaintext, instead it should be executed in the provided directory. Piping an ls command shows us the contents of directory where we see a "falg.txt" file.&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_15_29_39.png" alt=""><figcaption></figcaption></figure>

&#x20;We want to cat this file, instead of piping an ls we want to pipe a cat falg.txt command. Sending this request gives us the flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_15_31_19.png" alt=""><figcaption></figcaption></figure>

## 24. Some Assembly Required 3

<details>

<summary>Provided Hints:</summary>

(None)

</details>

**Description:** [http://mercury.picoctf.net:10388/index.html](http://mercury.picoctf.net:10388/index.html)

From previous Assembly challenges, we know we will be working with the wasm module. Where the flag usually is, we see two strings that could lead us to our flag.

The string seems to be a sequence of bytes, we can use a python module found online to xor the strings in the byte array.

```python
d_1024 = b'\x9dn\x93\xc8\xb2\xb9A\x8b\xc1\xc5\xdca\xc6\x97\x94\x8cf\x91\x91\pythoxc1\x893\x94\x9e\xc9\xdda\x91\xc4\xc8\xddb\xc0\x92\xc1\x8c7\x95\x93\xc8\x90'
d_1067 = b'\xf1\xa7\xf0\x07\xed'

out = bytearray()
for i, c in enumerate(d_1024):
    char = d_1067[4 - (i % 5)]
    out.append(c ^ char)
print(out)
```

Replace the two arrays with your own strings from the wasm module. The script XORs the bytes and the resulting XORed bytes are stored in the out bytearray. Execute the python module for the flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-05_16_03_37.png" alt=""><figcaption></figcaption></figure>
