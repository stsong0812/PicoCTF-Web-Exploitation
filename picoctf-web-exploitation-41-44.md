# PicoCTF Web Exploitation: 41-44

## 41. SQLiLite

\--------------------------------------UNDER MAINTENANCE---------------------------------------

## 42. Java Code Analysis!?!

<details>

<summary>Provided Hints:</summary>

(None)

</details>

**Description:** BookShelf Pico, my premium online book-reading service.I believe that my website is super secure. I challenge you to prove me wrong by reading the 'Flag' book!

Additional details will be available after launching your challenge instance.

**Writeup:** Launch the instance, download the source files and visit the website. We are given a login with the username and password as "user". There seems to be three available books to us, but only one we can access.&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_05_07.png" alt=""><figcaption></figcaption></figure>

Looking through the source files, these files and code blocks seem useful.

```
FILE: UserService.java

@PreAuthorize("hasAuthority('Admin')")
    public List<UserDto> getAllUsers() {
        return UserDto.getUserDtoListFromUsers(userRepository.findAll());
    }

    //returns a JWT if success
    public String login(UserLoginRequest userLoginRequest)...
```

We know we need "Admin" authorization, furthermore, it looks like a JWT token is returned upon successful login.

```
FILE: JwtService.java

    private static final String CLAIM_KEY_USER_ID = "userId";
    private static final String CLAIM_KEY_EMAIL = "email";
    private static final String CLAIM_KEY_ROLE = "role";
    private static final String ISSUER = "bookshelf";
    
    @Autowired
    public JwtService(SecretGenerator secretGenerator){
        this.SECRET_KEY = secretGenerator.getServerSecret();
    }

public String createToken(Integer userId, String email, String role){
        Algorithm algorithm = Algorithm.HMAC256(SECRET_KEY);

        Calendar expiration = Calendar.getInstance();
        expiration.add(Calendar.DATE, 7); //expires after 7 days

        return JWT.create()
                .withIssuer(ISSUER)
                .withIssuedAt(new Date())
                .withExpiresAt(expiration.getTime())
                .withClaim(CLAIM_KEY_USER_ID, userId)
                .withClaim(CLAIM_KEY_EMAIL, email)
                .withClaim(CLAIM_KEY_ROLE, role)
                .sign(algorithm);
    }
```

These code blocks give us the structure and how the JWT is created. A "secretGenerator" class is also referenced here which we will probably need in decoding our JWT token.

```
FILE: SecurityGenerator.java

@Service
class SecretGenerator {
    private Logger logger = LoggerFactory.getLogger(SecretGenerator.class);
    private static final String SERVER_SECRET_FILENAME = "server_secret.txt";

    @Autowired
    private UserDataPaths userDataPaths;

    private String generateRandomString(int len) {
        // not so random
        return "1234";
    }
```

Here we see the private class "generateRandomString" within the secretgenerator class that tells us our key is not so random, being "1234".

With this information, we have enough clues to decode and alter our JWT token in order to gain admin access. Still logged in as user, we can find our cookie under "Local Storage" in the Applications tab.&#x20;

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_15_43.png" alt=""><figcaption></figcaption></figure>

Copy the cookie and paste it into [https://jwt.io/#debugger-io](https://jwt.io/#debugger-io). Enter our "secret key" and change our role to admin, userid to 2, and email to admin.

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_27_53.png" alt=""><figcaption></figcaption></figure>

Lets try accessing the flag pdf, copy our new JWT token into "auth-token". Additionally, alter our token-payload to match our authentication token. Changing the role, userid, and email like we did in the JWT token. Entering our new values and refreshing the page gives us access to the flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_32_43.png" alt=""><figcaption></figcaption></figure>

## 43. Irish-Name-Repo 2

<details>

<summary>Provided Hints:</summary>

The password is being filtered.

</details>

**Description:** There is a website running at `https://jupiter.challenges.picoctf.org/problem/64649/` ([link](https://jupiter.challenges.picoctf.org/problem/64649/)). Someone has bypassed the login before, and now it's being strengthened. Try to see if you can still login! or http://jupiter.challenges.picoctf.org:64649

**Writeup:** Visit the site and navigate to the admin login page. From our last challenge, [#38.-irish-name-repo-1](picoctf-web-exploitation-37-40.md#38.-irish-name-repo-1 "mention"), we know this website utilizes SQL. This time, it seems our payload is being filtered. Trying our previous payload gives us this message:

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_37_31.png" alt=""><figcaption></figcaption></figure>

It looks like our 1' or '1=1 boolean statement is being filtered out. Attempting a different statement that doesn't utilize "=" or "or" might work. The statement " 'is not' " should do the trick as this also returns a true boolean value.

```
PAYLOAD:
username: admin    
password: 'is not'
```

Attempting this payload gives us our flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_41_01.png" alt=""><figcaption></figcaption></figure>

## 44. Irish-Name-Repo 3

<details>

<summary>Provided Hints:</summary>

Seems like the password is encrypted.

</details>

**Description:** There is a secure website running at `https://jupiter.challenges.picoctf.org/problem/54253/` ([link](https://jupiter.challenges.picoctf.org/problem/54253/)) or http://jupiter.challenges.picoctf.org:54253. Try to see if you can login as admin!

**Writeup:** Navigating to the admin login page now we only have a password input field. Trying "test" as password redirects us to a log in failed page with very little information.

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_51_41.png" alt=""><figcaption></figcaption></figure>

Lets try using BurpSuite to capture our request for more information. Opening BurpSuite's built-in browser and intercepting our test password shows us this:

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_52_57.png" alt=""><figcaption></figcaption></figure>

We see an additional paramter called debug. Sending this to our repeater, lets try altering our debug value to 1 and send the request.

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_11_54_47.png" alt=""><figcaption></figcaption></figure>

Now we get a valid response which also shows us the SQL query being made. Our test input turns int "grfg" which tells us our password is encrypted by a simple character substitution cypher. We know this as the number of characters is still the same and the 2 t's in test are both output as f. Upon futher examination, the cypher used is ROT13, which replaces the letters with the letter 13 places after it.

ROT13 is not applied to numbers or special characters so we can try replacing our password with the same payload as in [#43.-irish-name-repo-2](picoctf-web-exploitation-41-44.md#43.-irish-name-repo-2 "mention") but replacing "or" with "be". In ROT13, be is translated to or and vise versa. Submitting this payload gives us our flag.

<figure><img src=".gitbook/assets/Screenshot_2023-06-10_12_01_13.png" alt=""><figcaption></figcaption></figure>
